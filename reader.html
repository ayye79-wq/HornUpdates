<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Horn Updates • Reader</title>

  <!-- ✅ AdSense loader -->
  <script async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7773342225754932"
    crossorigin="anonymous"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: #f5f6f8;
      color: #111827;
      line-height: 1.6;
    }
    .wrap { max-width: 920px; margin: 0 auto; padding: 18px; }
    .topbar { display:flex; justify-content:space-between; margin-bottom:14px; gap:10px; }
    .brand a { text-decoration:none; color:#111827; font-weight:900; }
    .btn {
      padding:10px 12px; border-radius:12px; border:1px solid #e5e7eb;
      background:#fff; font-weight:700; cursor:pointer; text-decoration:none; color:#111827;
    }
    .btn.secondary { background:#f3f4f6; font-weight:600; }
    .actions { display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; }

    .card {
      background:#fff; border:1px solid #e5e7eb; border-radius:18px;
      box-shadow:0 10px 28px rgba(0,0,0,.06); padding:18px;
    }
    .meta { color:#6b7280; font-size:.95rem; display:flex; gap:10px; flex-wrap:wrap; }
    .pill { background:#f3f4f6; padding:4px 10px; border-radius:999px; font-size:.85rem; }
    h1 { font-size:1.4rem; margin:10px 0; }
    .summary { font-size:1.02rem; white-space:pre-wrap; }
    .divider { height:1px; background:#e5e7eb; margin:18px 0; }
    .muted { color:#6b7280; }

    .reader-box {
      margin:22px 0; padding:16px; background:#f9fafb;
      border:1px solid #e5e7eb; border-radius:14px; display:none;
    }
    .reader-box h3 { margin:0 0 8px; font-size:1rem; }

    .rtl { direction:rtl; text-align:right; line-height:1.9; }
  </style>
</head>

<body>
<div class="wrap">
  <div class="topbar">
    <div class="brand">
      <a href="index.html">Horn Updates</a>
      <span class="muted">• Reader</span>
    </div>
    <div class="actions">
      <a id="openBtn" class="btn" target="_blank">Read full article ↗</a>
      <button id="copyBtn" class="btn secondary">Copy link</button>
      <button id="shareBtn" class="btn secondary">Share</button>
      <a id="waBtn" class="btn secondary" target="_blank">WhatsApp</a>
      <a id="tgBtn" class="btn secondary" target="_blank">Telegram</a>
      <a id="fbBtn" class="btn secondary" target="_blank">Facebook</a>
    </div>
  </div>

  <div class="card">
    <div class="meta">
      <span class="pill" id="sourcePill">Source</span>
      <span class="pill" id="datePill">Date</span>
      <span class="pill" id="countryPill" style="display:none;"></span>
    </div>

    <h1 id="title">Loading…</h1>
    <div class="divider"></div>
    <div id="summary" class="summary"><span class="muted">Loading summary…</span></div>

    <div class="reader-box" id="whyBox">
      <h3>Why this matters</h3>
      <p id="whyText"></p>
    </div>

    <div class="reader-ad reader-ad-top" style="margin:22px 0;">
      <ins class="adsbygoogle" style="display:block"
        data-ad-client="ca-pub-7773342225754932"
        data-ad-slot="8296199432"
        data-ad-format="auto"></ins>
    </div>
    <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>

    <div class="divider"></div>
    <div class="muted"><strong>Attribution:</strong> This summary is written by Horn Updates.</div>
  </div>
</div>

<script>
/* ========= helpers ========= */
function normalizeStr(s){return(s??"").toString().toLowerCase().replace(/\s+/g," ").trim();}
function safeArr(x){return Array.isArray(x)?x:(x?[x]:[]);}
function includesAny(h,n){const s=normalizeStr(h);return safeArr(n).some(k=>s.includes(normalizeStr(k)));}
function stableHash(str){let h=2166136261;for(const c of String(str||"")){h^=c.charCodeAt(0);h=Math.imul(h,16777619);}return h>>>0;}

function pickWhyThisMatters(article,cfg){
  const text = normalizeStr(`${article.title} ${article.summary} ${article.source} ${(article.country_tags||[]).join(" ")}`);
  let best=null,p=-1;
  for(const g of cfg.groups){
    if(includesAny(text,g.match.any_keyword)&&g.priority>p){best=g;p=g.priority;}
  }
  const t=best?.templates||[cfg.default];
  return t[stableHash(article.title)%t.length];
}

/* ========= config ========= */
const WHY_CFG={
  default:{text:"Developments like this can signal broader regional or policy shifts affecting the Horn of Africa."},
  groups:[{
    priority:100,
    match:{any_keyword:["aid","humanitarian","wfp","unicef","usaid","refugee","famine","drought"]},
    templates:[
      {text:"Aid decisions can reshape access to food, medicine, and essential services, especially in fragile regions."},
      {text:"Humanitarian funding changes often reflect donor priorities and accountability concerns."}
    ]
  }]
};

/* ========= load ========= */
async function load(){
  const articleUrl=new URL(location.href).searchParams.get("url");
  if(!articleUrl)return location.href="index.html";
  openBtn.href=articleUrl;

  const res=await fetch("articles.json",{cache:"no-store"});
  const data=await res.json();
  const a=(data.articles||[]).find(x=>articleUrl.includes(x.link||""));
  if(!a)return;

  title.textContent=a.title;
  summary.textContent=a.summary;
  sourcePill.textContent="Source: "+a.source_name;
  datePill.textContent="Date: "+new Date(a.published_at).toLocaleDateString();

  const why=pickWhyThisMatters({
    title:a.title, summary:a.summary, source:a.source_name, country_tags:a.country_tags||[]
  },WHY_CFG);

  whyText.textContent=why.text;
  whyBox.style.display="block";
}
load();
</script>
</body>
</html>
