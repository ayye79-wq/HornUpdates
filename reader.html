<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Horn Updates ‚Ä¢ Reader</title>

  <link rel="canonical" id="canonicalLink" href="https://hornupdates.com/reader.html" />

  <!-- Organization Schema (site identity) -->
  <script type="application/ld+json" id="orgSchema">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "@id": "https://hornupdates.com/#organization",
    "name": "Horn Updates",
    "url": "https://hornupdates.com/",
    "logo": {
      "@type": "ImageObject",
      "url": "https://hornupdates.com/Horn1_logo.png"
    },
    "sameAs": [
      "https://x.com/HornUpdatesHQ"
    ]
  }
  </script>

  <!-- NewsArticle Schema Placeholder (populated after match is found) -->
  <script type="application/ld+json" id="newsSchema">
  {
    "@context": "https://schema.org",
    "@type": "NewsArticle"
  }
  </script>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: #f5f6f8;
      color: #111827;
      line-height: 1.6;
    }
    .wrap { max-width: 920px; margin: 0 auto; padding: 18px; }
    .topbar {
      display: flex; align-items: center; justify-content: space-between;
      gap: 10px; margin-bottom: 14px;
    }
    .brand a { text-decoration: none; color: #111827; font-weight: 900; }
    .btn {
      display: inline-block;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background: #fff;
      color: #111827;
      text-decoration: none;
      font-weight: 700;
      cursor: pointer;
    }
    .btn.secondary { background:#f3f4f6; font-weight:600; }
    .actions { display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; }

    .card {
      background:#fff;
      border:1px solid #e5e7eb;
      border-radius:18px;
      box-shadow:0 10px 28px rgba(0,0,0,.06);
      padding:18px;
    }
    .meta { color:#6b7280; font-size:.95rem; display:flex; gap:10px; flex-wrap:wrap; }
    .pill { background:#f3f4f6; padding:4px 10px; border-radius:999px; font-size:.85rem; }
    h1 { font-size:1.4rem; margin:10px 0; }
    .summary { font-size:1.02rem; white-space:pre-wrap; }
    .divider { height:1px; background:#e5e7eb; margin:18px 0; }
    .muted { color:#6b7280; }

    .rtl {
      direction: rtl;
      text-align: right;
      line-height: 1.9;
      font-family: "Segoe UI", Tahoma, Arial, sans-serif;
    }

    /* üîí Ads hidden by default (policy safe) */
    .reader-ad { display: none; }
/* =========================
   Reader-only typography
   ========================= */
.reader-page .card {
  max-width: 760px;
  margin: 0 auto;
}

.reader-page #title {
  font-size: 1.85rem;
  line-height: 1.2;
  letter-spacing: -0.01em;
  margin: 12px 0 10px;
}

.reader-page .summary {
  font-size: 1.12rem;
  line-height: 1.85;
  letter-spacing: 0.005em;
}

.reader-page .meta {
  font-size: 0.95rem;
}

.reader-page .pill {
  font-size: 0.85rem;
}

@media (max-width: 600px) {
  .reader-page #title { font-size: 1.55rem; }
  .reader-page .summary { font-size: 1.05rem; line-height: 1.8; }
}
/* Arabic / RTL readability */
.reader-page .rtl {
  font-size: 1.15rem;
  line-height: 2.0;
  letter-spacing: 0;
}
/* ===== Reader-only typography refinements ===== */
/* Reader headline (BBC-style, controlled) */
.reader-page #title {
  font-size: 1.45rem;   /* ‚Üê KEY FIX */
  line-height: 1.3;
  font-weight: 700;
  margin-top: 12px;
}

.reader-page .summary,
#summary {
  font-size: 1.08rem;
  line-height: 1.75;
  color: #1f2937;
}

.reader-page .meta,
.meta {
  font-size: 0.9rem;
  color: #6b7280;
}

    
  </style>
</head>

<body class="reader-page">

  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <a href="/">Horn Updates</a>
        <span class="muted">‚Ä¢ Reader</span>
      </div>
<div class="actions">
  <!-- Always visible -->
  <a id="openBtn" class="btn" target="_blank" rel="noopener noreferrer">
    Read full article ‚Üó
  </a>

  <!-- Share toggle -->
  <button id="shareToggle"
          class="btn secondary"
          type="button"
          aria-expanded="false"
          aria-controls="sharePanel">
    Share
  </button>

  <!-- Collapsible share panel -->
  <div id="sharePanel" class="share-panel" hidden>
    <button id="copyBtn" class="btn secondary" type="button">Copy link</button>
    <a id="waBtn" class="btn secondary" target="_blank" rel="noopener noreferrer">WhatsApp</a>
    <a id="tgBtn" class="btn secondary" target="_blank" rel="noopener noreferrer">Telegram</a>
    <a id="fbBtn" class="btn secondary" target="_blank" rel="noopener noreferrer">Facebook</a>
  </div>
</div>
</div>
    <div class="card">
      <div class="meta">
        <span class="pill" id="sourcePill">Source</span>
        <span class="pill" id="datePill">Date</span>
        <span class="pill" id="countryPill" style="display:none;"></span>
      </div>

      <h1 id="title">Loading‚Ä¶</h1>

      <div class="divider"></div>

      <div id="summary" class="summary">
        <span class="muted">Loading summary‚Ä¶</span>
      </div>

      <!-- Reader Top Ad (hidden until content is valid) -->
      <div class="reader-ad reader-ad-top" style="margin:22px 0;">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-7773342225754932"
             data-ad-slot="8296199432"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
      </div>

      <div class="divider"></div>

      <div class="muted" style="font-size:.95rem;">
        <strong>Attribution:</strong>
        This summary is written by Horn Updates.
        Full article remains on the publisher‚Äôs website.
      </div>

      <!-- Reader Bottom Ad (optional) -->
      <div class="reader-ad reader-ad-bottom" style="margin:22px 0;">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-7773342225754932"
             data-ad-slot="REPLACE_WITH_BOTTOM_SLOT"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
      </div>
    </div>
  </div>

  <!-- Canonical updater for ?id= -->
  <script>
    (function () {
      const id = new URLSearchParams(window.location.search).get("id");
      if (id) {
        const canon = document.getElementById("canonicalLink");
        if (canon) {
          canon.href = `https://hornupdates.com/reader.html?id=${encodeURIComponent(id)}`;
        }
      }
    })();
  </script>

  <script>
    // ---------- ADSENSE SAFE LOADER ----------
    function loadAdSenseOnce() {
      if (window.__adsense_loaded) return;
      window.__adsense_loaded = true;

      const s = document.createElement("script");
      s.async = true;
      s.src = "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7773342225754932";
      s.crossOrigin = "anonymous";
      document.head.appendChild(s);
    }

    function pushAdsSafely() {
      if (!window.adsbygoogle) window.adsbygoogle = [];
      document.querySelectorAll("ins.adsbygoogle").forEach(ins => {
        if (ins.getAttribute("data-adsbygoogle-status") === "done") return;
        try { (adsbygoogle = window.adsbygoogle || []).push({}); } catch (e) {}
      });
    }

    function wordCount(el) {
      const t = (el?.innerText || "").trim();
      return t ? t.split(/\s+/).length : 0;
    }

    function getParam(name) {
      return new URL(window.location.href).searchParams.get(name);
    }

    function isArabic(text) {
      return /[\u0600-\u06FF]/.test(text || "");
    }

    function norm(u) {
      try {
        const x = new URL(u);
        return x.hostname.replace(/^www\./, "") + x.pathname.replace(/\/$/, "");
      } catch { return ""; }
    }

    // ‚úÖ NewsArticle schema writer (called ONLY when match exists)
    function setNewsSchema(match, canonicalUrl) {
      try {
        const schemaEl = document.getElementById("newsSchema");
        if (!schemaEl) return;

        const description = (match.summary || "")
          .replace(/\s+/g, " ")
          .trim()
          .slice(0, 200);

        const publishedISO = match.published_at
          ? new Date(match.published_at).toISOString()
          : undefined;

        const imageUrl = match.image_url || "https://hornupdates.com/Horn1_logo.png";

        const data = {
          "@context": "https://schema.org",
          "@type": "NewsArticle",
          "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": canonicalUrl
          },
          "headline": (match.title || "Horn Updates").trim().slice(0, 110),
          "description": description || "AI-generated summary with a link to the original publisher.",
          "datePublished": publishedISO,
          "image": [imageUrl],
          "author": {
            "@type": "Organization",
            "name": "Horn Updates"
          },
          "publisher": {
            "@id": "https://hornupdates.com/#organization"
          },
          "isBasedOn": match.source_url || match.link
        };

        Object.keys(data).forEach(k => (data[k] == null || data[k] === "") && delete data[k]);

        schemaEl.textContent = JSON.stringify(data);
      } catch (e) {}
    }

    async function load() {
      const articleUrl = getParam("url");

      // ‚úÖ NO REDIRECT: show a friendly fallback
      if (!articleUrl) {
        document.querySelectorAll(".reader-ad, ins.adsbygoogle").forEach(el => el.style.display = "none");
        document.getElementById("openBtn").style.display = "none";
        document.getElementById("copyBtn").style.display = "none";
        document.getElementById("shareBtn").style.display = "none";
        document.getElementById("waBtn").style.display = "none";
        document.getElementById("tgBtn").style.display = "none";
        document.getElementById("fbBtn").style.display = "none";

        document.getElementById("title").textContent = "Article not available";
        document.getElementById("summary").innerHTML = `
          <p>This page displays article summaries when opened from Horn Updates.</p>
          <p>Please return to the <a href="/">homepage</a> to browse the latest stories.</p>
        `;
        return;
      }

      document.getElementById("openBtn").href = articleUrl;

      // ‚úÖ Wire share links/buttons
      const shareUrl = window.location.href;
      document.getElementById("waBtn").href = "https://wa.me/?text=" + encodeURIComponent(shareUrl);
      document.getElementById("tgBtn").href = "https://t.me/share/url?url=" + encodeURIComponent(shareUrl);
      document.getElementById("fbBtn").href = "https://www.facebook.com/sharer/sharer.php?u=" + encodeURIComponent(shareUrl);

      document.getElementById("copyBtn").onclick = async () => {
        try { await navigator.clipboard.writeText(shareUrl); } catch (e) {}
      };

      document.getElementById("shareBtn").onclick = async () => {
        try {
          if (navigator.share) await navigator.share({ url: shareUrl });
          else await navigator.clipboard.writeText(shareUrl);
        } catch (e) {}
      };

      try {
        const res = await fetch("articles.json", { cache: "no-store" });
        const data = await res.json();
        const articles = Array.isArray(data) ? data : (data.articles || []);
        const target = norm(articleUrl);

        const match = articles.find(a => norm(a.source_url || a.link || "") === target);

        if (!match) {
          document.getElementById("title").textContent = "Article";
          document.getElementById("summary").textContent =
            "We could not match this article yet. You can still read the full story.";
          return;
        }

        document.getElementById("title").textContent = match.title || "Article";
        document.getElementById("summary").textContent = match.summary || "";

        // ‚úÖ Populate NewsArticle schema only when real content exists
        const canonicalUrl = document.getElementById("canonicalLink").href;
        setNewsSchema(match, canonicalUrl);

        document.getElementById("sourcePill").textContent =
          "Source: " + (match.source_name || "Source");

        document.getElementById("datePill").textContent =
          "Date: " + (match.published_at ? new Date(match.published_at).toLocaleDateString() : "‚Äî");

        if (Array.isArray(match.country_tags) && match.country_tags.length) {
          const c = document.getElementById("countryPill");
          c.style.display = "inline-block";
          c.textContent = "Country: " + match.country_tags.join(", ");
        }

        const sumEl = document.getElementById("summary");
        if (isArabic(match.summary) || isArabic(match.title)) {
          sumEl.classList.add("rtl");
          document.getElementById("title").classList.add("rtl");
        }

        // ‚úÖ ADS ONLY IF CONTENT IS REAL (>= 120 words)
        const wc = wordCount(sumEl);
        if (wc >= 120) {
          document.querySelectorAll(".reader-ad").forEach(el => el.style.display = "block");
          loadAdSenseOnce();
          setTimeout(pushAdsSafely, 800);
        } else {
          document.querySelectorAll(".reader-ad, ins.adsbygoogle").forEach(el => el.style.display = "none");
        }

      } catch (e) {
        document.getElementById("title").textContent = "Error";
        document.getElementById("summary").textContent = "Could not load article.";
        document.querySelectorAll(".reader-ad, ins.adsbygoogle").forEach(el => el.style.display = "none");
      }
    }

    load();
  </script>

  <footer class="site-footer" style="margin-top:32px; padding:18px; text-align:center; font-size:.9rem; color:#6b7280;">
    <p>¬© 2025 Horn Updates. All rights reserved.</p>

    <p class="footer-links" style="margin:8px 0;">
      <a href="/about.html">About</a> ‚Ä¢
      <a href="/editorial-policy.html">Editorial Policy</a> ‚Ä¢
      <a href="/privacy.html">Privacy</a> ‚Ä¢
      <a href="/terms.html">Terms</a> ‚Ä¢
      <a href="/contact.html">Contact</a>
    </p>

    <p style="margin-top:6px;">
      This page displays AI-generated summaries with links to original publishers.
    </p>
  </footer>

</body>
</html>
